<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Master</title>
    <style>
        :root { --primary: #2563eb; --success: #059669; --error: #dc2626; --bg: #f8fafc; --text-main: #1e293b; --text-sub: #64748b; --gray-hint: #f1f5f9; }
        body { font-family: 'Inter', system-ui, sans-serif; background-color: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: #1e293b; color: white; padding: 1.5rem; text-align: center; }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 300px; background: white; padding: 30px; border-right: 1px solid #e2e8f0; }
        .sidebar h2 { font-size: 1.2rem; margin-bottom: 20px; color: var(--text-main); }
        .quiz-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        
        .score-board { position: absolute; top: 20px; right: 20px; background: white; padding: 10px 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; display: flex; gap: 15px; font-weight: 700; font-size: 1.1rem; }
        .score-correct { color: var(--success); }
        .score-wrong { color: var(--error); }

        .card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 100%; max-width: 600px; position: relative; }
        .progress-info { color: var(--text-sub); font-weight: 600; font-size: 0.9rem; margin-bottom: 15px; display: flex; justify-content: space-between; border-bottom: 1px solid #f1f5f9; padding-bottom: 10px; }
        .question { font-size: 1.4rem; font-weight: 700; margin-bottom: 25px; color: var(--text-main); line-height: 1.5; }
        .option { background: #f1f5f9; padding: 16px; margin-bottom: 12px; border-radius: 10px; cursor: pointer; transition: 0.2s; border: 2px solid transparent; font-size: 1.1rem; }
        .option:hover { background: #e2e8f0; }
        .correct { background: #d1fae5 !important; border-color: var(--success) !important; color: #065f46; }
        .wrong { background: #fee2e2 !important; border-color: var(--error) !important; color: #991b1b; }
        .bottom-area { margin-top: 20px; min-height: 80px; display: flex; flex-direction: column; }
        .feedback { font-weight: 600; font-size: 1.1rem; text-align: center; margin-bottom: 10px; height: 24px; }
        .hint-container { display: flex; flex-direction: column; align-items: flex-start; width: 100%; }
        .hint-btn { background: none; border: none; color: var(--text-sub); font-weight: 600; font-size: 0.9rem; cursor: pointer; padding: 5px 0; display: none; text-decoration: underline; }
        .hint-text { background: var(--gray-hint); border-left: 4px solid #cbd5e1; padding: 12px 15px; border-radius: 4px; color: #475569; font-size: 0.9rem; display: none; margin-top: 5px; width: 95%; line-height: 1.4; }
        button.main-btn { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1rem; font-weight: 600; }
        select { width: 100%; padding: 12px; margin: 8px 0 24px; border-radius: 8px; border: 1px solid #cbd5e1; }
        .hidden { display: none; }
    </style>
</head>
<body>

<header>
    <h1>Vocabulary Master ðŸŽ“</h1>
</header>

<div class="main-container">
    <div class="sidebar">
        <h2>Quiz Settings</h2>
        <label>Grade Level</label>
        <select id="grade">
            <option value="1-2">Grades 1-2</option>
            <option value="3-4">Grades 3-4</option>
            <option value="5">Grade 5</option>
        </select>
        <label>Subject Topic</label>
        <select id="subject">
            <option value="ELA">Literature & ELA</option>
            <option value="Math">Mathematics</option>
            <option value="Science">Science & Nature</option>
        </select>
        <button class="main-btn" onclick="initQuiz()">Start Quiz</button>
    </div>

    <div class="quiz-area">
        <div id="score-board" class="score-board hidden">
            <span class="score-correct">O : <span id="count-o">0</span></span>
            <span class="score-wrong">X : <span id="count-x">0</span></span>
        </div>

        <div id="quiz-card" class="card hidden">
            <div class="progress-info">
                <span id="set-info">Set 1 of 3</span>
                <span id="q-progress">Question 1 / 5</span>
            </div>
            <div id="q-text" class="question">Loading...</div>
            <div id="options-box"></div>
            <div class="bottom-area">
                <div id="feedback" class="feedback"></div>
                <div class="hint-container">
                    <button id="hint-btn" class="hint-btn" onclick="showHint()">Need a hint? Click here â†“</button>
                    <div id="hint-text" class="hint-text"></div>
                </div>
            </div>
        </div>

        <div id="result-card" class="card hidden" style="text-align: center;">
            <h2 style="color: var(--success); font-size: 2rem;">Set Complete! ðŸŒŸ</h2>
            <p id="result-msg" style="font-size: 1.2rem; color: #475569;">You've mastered this set.</p>
            <button id="next-set-btn" class="main-btn" style="width: auto; padding: 12px 40px;">Next Set</button>
        </div>
    </div>
</div>

<script>
// Database ìƒëžµ (v4.4ì™€ ë™ì¼í•œ í’ì„±í•œ ë°ì´í„°ê°€ í¬í•¨ë©ë‹ˆë‹¤)
const database = { /* ... ìœ„ ì‘ë‹µì˜ ë°ì´í„°ì™€ ë™ì¼ ... */ }; 
/* ë°ì´í„°ê°€ ë„ˆë¬´ ê¸¸ì–´ íŽ¸ì˜ìƒ ìƒëžµí•˜ì§€ë§Œ, ì‹¤ì œ ì½”ë“œì—ì„œëŠ” ìœ„ ë²„ì „ì˜ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. */

let allPool = [];
let activeQuestions = [];
let curIdx = 0;
let setNum = 1;
let totalSets = 0;
let canClick = true;

// Score Variables
let correctCount = 0;
let wrongCount = 0;
let hasMistakeInCurrentQuestion = false; // í˜„ìž¬ ë¬¸ì œì—ì„œ í‹€ë¦° ì ì´ ìžˆëŠ”ì§€ ì¶”ì 

function initQuiz() {
    const g = document.getElementById('grade').value;
    const s = document.getElementById('subject').value;
    allPool = [...database[g][s]].sort(() => Math.random() - 0.5);
    totalSets = Math.ceil(allPool.length / 5);
    setNum = 1;
    
    correctCount = 0;
    wrongCount = 0;
    updateScoreUI();
    document.getElementById('score-board').classList.remove('hidden');
    startNewSet();
}

function updateScoreUI() {
    document.getElementById('count-o').innerText = correctCount;
    document.getElementById('count-x').innerText = wrongCount;
}

function startNewSet() {
    const start = (setNum - 1) * 5;
    activeQuestions = allPool.slice(start, start + 5);
    curIdx = 0;
    document.getElementById('quiz-card').classList.remove('hidden');
    document.getElementById('result-card').classList.add('hidden');
    showQuestion();
}

function showQuestion() {
    canClick = true;
    hasMistakeInCurrentQuestion = false; // ìƒˆ ë¬¸ì œ ì‹œìž‘ ì‹œ ì˜¤ë‹µ ì—¬ë¶€ ì´ˆê¸°í™”
    const data = activeQuestions[curIdx];
    document.getElementById('set-info').innerText = `Set ${setNum} of ${totalSets}`;
    document.getElementById('q-progress').innerText = `Question ${curIdx + 1} / ${activeQuestions.length}`;
    document.getElementById('q-text').innerText = data.q;
    document.getElementById('feedback').innerText = "";
    document.getElementById('hint-btn').style.display = "none";
    document.getElementById('hint-text').style.display = "none";
    
    const box = document.getElementById('options-box');
    box.innerHTML = "";
    [...data.o].sort(() => Math.random() - 0.5).forEach(opt => {
        const div = document.createElement('div');
        div.className = 'option';
        div.innerText = opt;
        div.onclick = () => check(div, opt, data.a);
        box.appendChild(div);
    });
}

function check(el, selected, correct) {
    if(!canClick) return;
    
    if(selected === correct) {
        canClick = false;
        // ì´ ë¬¸ì œë¥¼ í•œ ë²ˆë„ í‹€ë¦¬ì§€ ì•Šê³  ë§žì·„ì„ ë•Œë§Œ O ì¹´ìš´íŠ¸
        if (!hasMistakeInCurrentQuestion) {
            correctCount++;
        } else {
            // ì´ë¯¸ í‹€ë ¸ë˜ ë¬¸ì œë¼ë©´ X ì¹´ìš´íŠ¸ëŠ” ì´ë¯¸ ì˜¬ë¼ê°”ìœ¼ë¯€ë¡œ OëŠ” ì˜¬ë¦¬ì§€ ì•ŠìŒ
        }
        updateScoreUI();
        
        el.classList.add('correct');
        document.getElementById('feedback').innerText = "Correct! ðŸ†";
        document.getElementById('feedback').style.color = "var(--success)";
        setTimeout(() => {
            curIdx++;
            if(curIdx < activeQuestions.length) showQuestion();
            else showFinalResult();
        }, 1200);
    } else {
        // ì²˜ìŒ í‹€ë ¸ì„ ë•Œë§Œ X ì¹´ìš´íŠ¸ (í•œ ë¬¸ì œë‹¹ XëŠ” ìµœëŒ€ 1ê°œ)
        if (!hasMistakeInCurrentQuestion) {
            wrongCount++;
            hasMistakeInCurrentQuestion = true;
            updateScoreUI();
        }
        el.classList.add('wrong');
        document.getElementById('feedback').innerText = "Try again!";
        document.getElementById('feedback').style.color = "var(--error)";
        document.getElementById('hint-btn').style.display = "block";
        setTimeout(() => el.classList.remove('wrong'), 800);
    }
}

function showHint() {
    const data = activeQuestions[curIdx];
    const hintBox = document.getElementById('hint-text');
    hintBox.innerHTML = `<strong>HINT:</strong> ${data.h || "Think carefully!"}`;
    hintBox.style.display = "block";
    document.getElementById('hint-btn').style.display = "none";
}

function showFinalResult() {
    document.getElementById('quiz-card').classList.add('hidden');
    document.getElementById('result-card').classList.remove('hidden');
    const btn = document.getElementById('next-set-btn');
    if (setNum < totalSets) {
        btn.innerText = "Start Next Set";
        btn.onclick = () => { setNum++; startNewSet(); };
    } else {
        btn.innerText = "Finish & Restart";
        btn.onclick = () => location.reload();
    }
}
</script>
</body>
</html>
